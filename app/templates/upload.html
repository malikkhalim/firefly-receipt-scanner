{% extends "base.html" %}

{% block title %}Upload Receipt{% endblock %}

{% block content %}
<h1>Receipt Scanner</h1>
<p class="subtitle">Upload an image of your receipt to get started.</p>

<form id="receipt-form" action="/extract" method="post" enctype="multipart/form-data" onsubmit="showLoading()">
    
    {% if success_message %}
    <div class="alert success">
        {{ success_message }}
    </div>
    {% endif %}

    <div class="form-group">
        <label for="source_account">Source Account:</label>
        <select id="source_account" name="source_account" required>
            {% for account in asset_accounts %}
            <option value="{{ account }}">{{ account }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Receipt Image:</label>
        <div class="file-upload-wrapper">
            <input type="file" id="file" name="file" accept="image/*" capture="environment" required>
            <div class="file-upload-text">
                Drag & Drop or <span>Browse File</span>
            </div>
            <div id="file-name"></div>
        </div>
    </div>

    <div class="form-group">
        <button type="submit" id="submit-btn" class="btn">Extract Receipt Data</button>
    </div>
</form>

<div id="loading" class="loading">
    <p>Processing receipt... This may take a minute.<br>Please don't close this page.</p>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function showLoading() {
        document.getElementById('loading').classList.add('active');
        document.getElementById('submit-btn').disabled = true;
    }

    const fileInput = document.getElementById('file');
    const fileNameDisplay = document.getElementById('file-name');

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = `Selected: ${fileInput.files[0].name}`;
        } else {
            fileNameDisplay.textContent = '';
        }
    });
</script>
{% endblock %}